<html>
<head>
  <link rel="stylesheet" href="/styles/line_chart.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <script src="http://d3js.org/d3.v4.js"></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/spin.js/2.0.1/spin.min.js'></script>
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  <style>
  </style>
</head>
<body>
  <div>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
  <span class="navbar-toggler-icon"></span>
</button>
<div class="collapse navbar-collapse" id="navbarNavAltMarkup">
  <div class="navbar-nav">
    <a class="nav-item nav-link active" href="./">Home <span class="sr-only">(current)</span></a>
    <a class="nav-item nav-link" href="./line">Yearwise Word Trends</a>
    <a class="nav-item nav-link" href="./word_cloud">Popular Words</a>
    <a class="nav-item nav-link" href="./similarity">Similarity in Artists</a>
  </div>
</div>
</nav>
    </div>
  <div class="input-group mb-3" style="width:300px; margin:auto">
  <input name="word" type="text" id="searchWord" class="form-control" placeholder="love"
  aria-label="Small" aria-describedby="inputGroup-sizing-sm">
  <div class="input-group-append">
    <button class="btn btn-outline-secondary" type="button" onClick="searchWord()">Search</button>
  </div>
</div>
  <div id="plot" style="width:70%; margin:auto">
    <div id="spinner" style="width:40">
    </div>
  </div>
  <script>

    var margin = 30;
    var w = 700, h = 500 - 2 * margin;

    var svg = d3.select('#plot').append("svg")
              .attr("width", w)
              .attr("height", h + 2*margin)
              .append("svg:g")
              .attr("transform", "translate(" + 2*margin + ", " + margin + ")");

              var opts = {
                lines: 9, // The number of lines to draw
                length: 7, // The length of each line
                width: 4, // The line thickness
                radius: 10, // The radius of the inner circle
                color: '#004e6b', // #rgb or #rrggbb or array of colors
                speed: 1.9, // Rounds per second
                trail: 40, // Afterglow percentage
                className: 'spinner', // The CSS class to assign to the spinner
              };

    function searchWord()
    {
      word = document.getElementById("searchWord").value;
      console.log("Search Word:", word);
      d3.select("#line-id").remove();
      d3.selectAll(".x.axis").remove();
      d3.selectAll(".y.axis").remove();
      d3.selectAll(".label").remove();
      d3.selectAll(".area").remove();
      var spinner = new Spinner(opts).spin(document.getElementById("spinner"));
      setTimeout(function(){
          console.log('after');
          spinner.stop();
          word_line_charts(word);
        }, 5000);
    }

    function word_line_charts(word){
      d3.json("data/"+word, load_data);

      function load_data(data){
        console.log(data);
        data = data[word];
        line_chart(data, word);
      };
    }

    function line_chart(data, word){
      WIDTH = 1000,
      HEIGHT = 500,
      MARGINS = {
        top: 20,
        right: 20,
        bottom: 20,
        left: 20
      }

      //X and Y axis
      xRange = d3.scaleLinear().range([0, w]).domain([d3.min(data, function(d) {
       return Object.keys(d)[0];
     }), d3.max(data, function(d) {
       return Object.keys(d)[0];
     })]),
     yRange = d3.scaleLinear().range([h, 0]).domain([d3.min(data, function(d) {
       return d[Object.keys(d)[0]];
     }), d3.max(data, function(d) {
       return d[Object.keys(d)[0]];
     })]),
     xAxis = d3.axisBottom()
       .scale(xRange)
       .tickSize(4),
     yAxis = d3.axisLeft()
       .scale(yRange)
       .tickSize(4);

       svg.append('svg:g')
      .attr('class', 'x axis')
      .attr("transform", "translate(0, " + h  + ")")
      .call(xAxis);

      svg.append('svg:g')
      .attr('class', 'y axis')
      .call(yAxis);

      var area = d3.area()
      .x(function(d) {
        return xRange( Object.keys(d)[0]);
      })
      .y0(h)
      .y1(function(d) {
        return yRange(d[Object.keys(d)[0]]);
      });

      var lineFunc = d3.line()
     .x(function(d) {
       return xRange( Object.keys(d)[0]);
     })
     .y(function(d) {
       return yRange(d[Object.keys(d)[0]]);
     });

     svg.append('svg:path')
     .attr('d', lineFunc(data))
     .attr('stroke', '#69b8d6')
     .attr('stroke-width', 4)
     .attr('fill', 'none')
     .attr("id", "line-id");

     svg.append('svg:path')
     .attr('d', area(data))
     .attr('fill', '#daeffe')
     .attr("class", "area");

     // text label for the x axis
       svg.append("text")
       .attr("transform",
            "translate(" + (w/2) + " ," +
                           (h+margin) + ")")
      .attr("class", "label")
      .style("text-anchor", "middle")
      .text("Years");

      // text label for the y axis
      svg.append("text")
      .attr("transform", "rotate(-90)")
      .attr("y",0-2*margin)
      .attr("x",0-h/2)
      .attr("dy", "1em")
      .attr("class", "label")
      .style("text-anchor", "middle")
      .text("Count of word \""+word+"\"");
    }

    word_line_charts("love")
  </script>
</body>
</html>
